# Timezone finder
This is a [D](https://dlang.org) port of [tzf-rs](https://github.com/ringsaturn/tzf-rs) tool.
It allows to get the time zone based on the coord data (longitude, latitude).

## Build
This is going to be normal [dub](https://dub.pm) package.
### Dependencies
- geomedry (internal code)
- [rtree](https://code.dlang.org/packages/rtree)
- [protobuf](https://code.dlang.org/packages/protobuf)

To get the CLI tool:
```bash
dub fetch tzf_d
```

To build it locally (require D compiler) you can clone the repo and use command:
```bash
dub build -b=release
```

## Usage example
To get the result you need to provide (longitude, latitude) as shown below:
```bash
tzf_d --lng=100.123 --lat=-42.123
```
Because of regression in D compiler, currently code is working only with dmd 2.103/ ldc 1.33.

## Structure of the project
```bash
├── Readme.md
├── data
│   ├── combined-with-oceans.reduce.compress.pb
│   ├── combined-with-oceans.reduce.pb
│   └── combined-with-oceans.reduce.preindex.pb
├── dub.json
└── source
    ├── app.d
    ├── geomedry.d
    ├── lib.d
    ├── package.d
    ├── pb
    │   └── tzinfo.d
    └── tzf_rel.d
```
- data: has data files, that will be used to match time zone
- source/app.d: CLI code
- source/geomedry.d: library with geometry primitives (could be used separatly)
- source/lib.d: main library code with internal classes and logic
- source/pb/tzinfo.d: structure description generated by protoc
- source/tzf_rel.d: separate file to load data

## Todo
- [ ] Make code more iDiomatic
- [ ] Fix dub configuration, to make code available as both CLI and D library
- [ ] Improve performance
- [ ] Reduce copy of the data (adding ref and other attributes)
- [ ] struct vs class
- [ ] make protobuf generation automatically in dub
- [ ] consider code that download only required data, instead of storing all data in the package (~18Mb)
- [ ] Improve CLI functionality: add help and proper args parsing (maybe with [commandr](https://code.dlang.org/packages/commandr))

## References
* cudos to original repo [tzf-rs](https://github.com/ringsaturn/tzf-rs)
* geomeDry is a D port of Rust's port [geometry-rs](https://github.com/ringsaturn/geometry-rs) of Go's package [geometry](https://github.com/tidwall/geometry).
* data file taken from [tzf-rel](https://github.com/ringsaturn/tzf-rel) repo.
* original data source is located in the repo [timezone-boundary-builder](https://github.com/evansiroky/timezone-boundary-builder)

## LICENSE
This project is licensed under the [MIT license](https://github.com/ringsaturn/tzf-rs/blob/main/LICENSE). The data is licensed under the [ODbL license](https://github.com/ringsaturn/tzf-rel/blob/main/LICENSE), same as [evansiroky/timezone-boundary-builder](https://github.com/evansiroky/timezone-boundary-builder)